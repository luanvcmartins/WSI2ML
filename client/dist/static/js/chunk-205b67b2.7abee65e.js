(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-205b67b2"],{"43fa":function(t,n,e){},a415:function(t,n,e){"use strict";e.r(n);var a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-container",{attrs:{"grid-list-md":""}},[e("v-row",t._l(t.projects,(function(n){return e("v-col",{key:n.id,attrs:{cols:"12",sm:"12",md:"6"}},[e("v-card",[e("v-card-title",{domProps:{textContent:t._s(n.name)}}),e("v-card-text",{domProps:{textContent:t._s(n.description)}}),e("v-divider"),e("v-card-actions",[e("v-spacer"),e("v-btn",{attrs:{text:"",block:""},on:{click:function(e){return t.showExporting(n)}}},[t._v("Export annotations")])],1)],1)],1)})),1),e("export-task-annotation",{attrs:{project:t.selected_project},model:{value:t.dialog,callback:function(n){t.dialog=n},expression:"dialog"}})],1)},o=[],i=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-dialog",{attrs:{transition:"dialog-bottom-transition",scrollable:"",fullscreen:"","hide-overlay":""},model:{value:t.dialog,callback:function(n){t.dialog=n},expression:"dialog"}},[null!=t.project?e("v-card",{attrs:{tile:""}},[e("v-toolbar",{attrs:{flat:"",dark:"",dense:"",color:"primary",extended:"","extension-height":"180","shrink-on-scroll":""},scopedSlots:t._u([{key:"extension",fn:function(){return[e("div",{staticClass:"text-center full-width",staticStyle:{width:"100%"}},[e("div",{staticClass:"ma-1 grey--text text--lighten-2 text-h4"},[t._v("Exporting annotations")]),e("div",{staticClass:"ma-1 grey--text text--lighten-1"},[t._v("Exporting "+t._s(t.total_annotations)+" annotations.")]),e("div",{staticClass:"mt-1"},[e("p",[e("v-btn",{attrs:{disabled:0===t.total_annotations,rounded:"",outlined:"","x-large":""},on:{click:t.exportAnnotations}},[t._v("\n                Export annotations\n              ")])],1),e("p",[null!=t.annotators?e("v-menu",{scopedSlots:t._u([{key:"activator",fn:function(n){var a=n.on,o=n.attrs;return[e("v-btn",t._g(t._b({staticClass:"ma-1",attrs:{rounded:"",outlined:""}},"v-btn",o,!1),a),[t._v("\n                    Select annotations by...\n                  ")])]}}],null,!1,3161919569)},[e("v-list",[e("v-list-item",{on:{click:function(n){return t.selectAll()}}},[e("v-list-item-title",[t._v("Everyone")])],1),e("v-divider"),t._l(Object.keys(t.annotators),(function(n,a){return e("v-list-item",{key:a,on:{click:function(e){return t.selectAll(t.annotators[n])}}},[e("v-list-item-title",[t._v(t._s(n))])],1)}))],2)],1):t._e(),null!=t.reviewers?e("v-menu",{scopedSlots:t._u([{key:"activator",fn:function(n){var a=n.on,o=n.attrs;return[e("v-btn",t._g(t._b({staticClass:"ma-1",attrs:{rounded:"",outlined:""}},"v-btn",o,!1),a),[t._v("\n                    Filter revisions by...\n                  ")])]}}],null,!1,3323599149)},[e("v-list",t._l(Object.keys(t.reviewers),(function(n,a){return e("v-list-item",{key:a,on:{click:function(e){return t.selectReviewer(t.reviewers[n])}}},[e("v-list-item-title",[t._v(t._s(n))])],1)})),1)],1):t._e()],1)])])]},proxy:!0}],null,!1,306776646)},[e("v-btn",{attrs:{icon:"",dark:""},on:{click:t.close}},[e("v-icon",[t._v("mdi-close")])],1),e("v-toolbar-title",{domProps:{textContent:t._s(t.project.name)}})],1),e("v-card-text",[e("v-container",[e("v-row"),e("v-row",t._l(t.tasks,(function(n){return e("v-col",{key:n.id,attrs:{md:"6"}},[e("v-card",[e("v-card-title",{domProps:{textContent:t._s(null==n.name?n.name:n.slides.length+" slide(s) annotation task")}}),e("v-chip-group",{staticClass:"pl-3 pr-3"},t._l(n.slides,(function(n){return e("v-chip",{key:n.id,staticStyle:{"pointer-events":"none"},attrs:{readonly:!0,outlined:""},domProps:{textContent:t._s(n.name)}})})),1),0===n.annotated.length?e("v-card-text",[t._v("\n                This task has received no annotations yet.\n              ")]):e("v-card-text",[e("div",{staticClass:"text-body-1"},[t._v("Export annotations from:")]),e("v-expansion-panels",{attrs:{multiple:"",hover:"",accordion:""},model:{value:t.annotated_selected[n.id],callback:function(e){t.$set(t.annotated_selected,n.id,e)},expression:"annotated_selected[task.id]"}},t._l(n.annotated,(function(n){return e("v-expansion-panel",{key:n.user_task_id,on:{change:function(e){return t.panelChanged(n)}}},[e("v-expansion-panel-header",{attrs:{"disable-icon-rotate":""},scopedSlots:t._u([{key:"default",fn:function(a){var o=a.open;return[e("v-row",{attrs:{"no-gutters":""}},[e("v-col",{attrs:{cols:"5"}},[o?e("v-icon",[t._v("\n                              mdi-check\n                            ")]):t._e(),t._v("\n                            "+t._s(n.user_name)+" (total annotations: "+t._s(n.annotation_count)+")\n                          ")],1),e("v-col",{staticClass:"text--secondary",attrs:{cols:"7"}},[e("v-fade-transition",{attrs:{"leave-absolute":""}},[e("span",o?[t._v("Exporting "+t._s(t.annotation_counts[n.user_task_id])+" annotation(s)")]:[t._v("Currently not selected for exporting")])])],1)],1)]}}],null,!0)}),e("v-expansion-panel-content",{staticStyle:{border:"darkgrey 1px dotted","background-color":"whitesmoke"}},[null!=n.reviews&&n.reviews.length>0?e("div",[e("p",{staticClass:"ma-0 text-muted"},[t._v("Include only annotations revised by:")]),e("v-chip-group",{attrs:{multiple:"",column:""},model:{value:t.exporting[n.user_task_id],callback:function(e){t.$set(t.exporting,n.user_task_id,e)},expression:"exporting[annotation.user_task_id]"}},t._l(n.reviews,(function(n){return e("v-chip",{key:n.revision_user_task_id,staticClass:"ma-1",attrs:{pill:"",outlined:"",filter:"",value:n.revision_user_task_id},on:{click:function(n){return n.preventDefault(),t.count.apply(null,arguments)}}},[t._v("\n                            "+t._s(n.revision_by_name)+" ("+t._s(n.revision_count)+" annotations)\n                          ")])})),1)],1):e("div",[e("p",{staticClass:"ma-0 text-muted"},[t._v("Annotations not revised yet.")])])])],1)})),1)],1),e("v-divider"),null!=n.exporting?e("v-card-actions",[e("p",{staticClass:"ma-1 grey--text"},[t._v("Exporting "+t._s(n.exporting.count)+" annotations from this task")])]):t._e()],1)],1)})),1)],1)],1)],1):t._e()],1)},s=[],r=(e("7f7f"),e("6762"),e("2fdb"),e("ac6a"),{name:"ExportTaskAnnotation",watch:{project:{immediate:!0,handler:function(){this.load_tasks()}},value:function(t){this.dialog=t}},data:function(){return{tasks:null,exporting:{},annotation_counts:{},dialog:!1,annotated_selected:{}}},computed:{total_annotations:function(){var t=0;for(var n in this.annotation_counts)t+=this.annotation_counts[n];return t},annotators:function(){var t={};return null!=this.tasks&&this.tasks.forEach((function(n){n.annotated.forEach((function(n){n.user_name in t||(t[n.user_name]=[]),t[n.user_name].push(n.user_task_id)}))})),t},reviewers:function(){var t={};return null!=this.tasks&&this.tasks.forEach((function(n){n.annotated.forEach((function(n){null!=n.reviews&&n.reviews.forEach((function(e){console.log("Reviewer:",e.revision_by_name),e.revision_by_name in t||(t[e.revision_by_name]=[]),t[e.revision_by_name].push({annotation:n.user_task_id,revision:e.revision_user_task_id})}))}))})),t}},methods:{close:function(){this.$emit("input",!1)},load_tasks:function(){var t=this;null!=this.project&&this.$get("export/list/by_task",{params:{project_id:this.project.id}}).then((function(n){return t.tasks=n})).catch((function(t){return alert(t)}))},panelChanged:function(t){var n=this;console.log("panelChanged",t),t.user_task_id in this.exporting?(delete this.exporting[t.user_task_id],this.annotation_counts[t.user_task_id]=0):(this.exporting[t.user_task_id]=[],this.$set(this.annotation_counts,t.user_task_id,t.annotation_count)),null==t.reviews&&this.$get("export/review/by_task",{params:{user_task_id:t.user_task_id}}).then((function(e){return n.$set(t,"reviews",e)})).catch((function(t){return alert(t)}))},selectAll:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tasks.forEach((function(e){var a=0;e.annotated.forEach((function(o){(null==n||n.includes(o.user_task_id))&&(o.user_task_id in t.exporting||(t.panelChanged(o),e.id in t.annotated_selected||(t.annotated_selected[e.id]=[]),t.annotated_selected[e.id].push(a))),a+=1}))}))},selectReviewer:function(t){var n=this;t.forEach((function(t){n.exporting[t.annotation].push(t.revision)})),this.count()},exportAnnotations:function(){var t=this;this.$post("export/by_task",this.exporting,{responseType:"blob"}).then((function(n){var e=window.URL.createObjectURL(new Blob([n])),a=document.createElement("a");a.href=e,a.setAttribute("download","".concat(t.project.name,".zip")),document.body.appendChild(a),a.click(),document.body.removeChild(a)})).catch((function(t){return alert(t)}))},count:function(){var t=this;setTimeout((function(){t.$post("export/count",t.exporting).then((function(n){return t.annotation_counts=n})).catch((function(t){return alert(t)}))}),1e3)}},props:["project","value"]}),c=r,l=e("2877"),u=e("6544"),d=e.n(u),v=e("8336"),_=e("b0af"),p=e("99d9"),h=e("cc20"),f=e("ef9a"),m=e("62ad"),x=e("a523"),k=e("169a"),g=e("ce7e"),b=e("cd55"),y=e("49e2"),C=e("c865"),w=e("0393"),V=e("0789"),E=e("132d"),j=e("8860"),T=e("da13"),$=e("5d23"),A=e("e449"),P=e("0fd9"),S=e("71d9"),R=e("2a7f"),L=Object(l["a"])(c,i,s,!1,null,"2f3107c8",null),O=L.exports;d()(L,{VBtn:v["a"],VCard:_["a"],VCardActions:p["a"],VCardText:p["b"],VCardTitle:p["c"],VChip:h["a"],VChipGroup:f["a"],VCol:m["a"],VContainer:x["a"],VDialog:k["a"],VDivider:g["a"],VExpansionPanel:b["a"],VExpansionPanelContent:y["a"],VExpansionPanelHeader:C["a"],VExpansionPanels:w["a"],VFadeTransition:V["d"],VIcon:E["a"],VList:j["a"],VListItem:T["a"],VListItemTitle:$["c"],VMenu:A["a"],VRow:P["a"],VToolbar:S["a"],VToolbarTitle:R["a"]});var D={name:"Export",components:{ExportTaskAnnotation:O},watch:{selected_users:{deep:!0,handler:function(t){}}},data:function(){return{dialog:!1,projects:[],selected_project:null,selected_users:{},selected_user_tasks:{},exporting:{},annotation_counts:{}}},methods:{load:function(){var t=this;this.$get("export/list").then((function(n){return t.projects=n})).catch((function(t){return alert(t)}))},showExporting:function(t){this.selected_project=t,this.dialog=!0}},mounted:function(){this.load()}},I=D,B=(e("de7e"),e("2fa4")),F=Object(l["a"])(I,a,o,!1,null,"5cd5abbc",null);n["default"]=F.exports;d()(F,{VBtn:v["a"],VCard:_["a"],VCardActions:p["a"],VCardText:p["b"],VCardTitle:p["c"],VCol:m["a"],VContainer:x["a"],VDivider:g["a"],VRow:P["a"],VSpacer:B["a"]})},de7e:function(t,n,e){"use strict";e("43fa")}}]);
//# sourceMappingURL=chunk-205b67b2.7abee65e.js.map